{
  "name": "collaborativeStateMachine",
  "version": "0.1",
  "persistentContext": {
    "variables": [
      {
        "name": "persistentDataVariable",
        "value": "0"
      }
    ]
  },
  "stateMachines": [
    {
      "name": "crossing",
      "states": [
        {
          "name": "gate",
          "localContext": {
            "variables": [
              {
                "name": "localDataVariable",
                "value": "0"
              }
            ]
          },
          "states": [
            {
              "name": "up",
              "initial": true,
              "on": [
                {
                  "event": "gateUp",
                  "actions": [
                    {
                      "reference": "doGateUp"
                    }
                  ]
                },
                {
                  "event": "gateDown",
                  "target": "down"
                }
              ]
            },
            {
              "name": "down",
              "on": [
                {
                  "event": "gateDown",
                  "actions": [
                    {
                      "reference": "doGateDown"
                    }
                  ]
                },
                {
                  "event": "gateUp",
                  "target": "up"
                }
              ]
            }
          ],
          "actions": [
            {
              "name": "doGateUp",
              "type": "invoke",
              "serviceType": "gateUp",
              "isLocal": true
            },
            {
              "name": "doGateDown",
              "type": "invoke",
              "serviceType": "gateDown",
              "isLocal": true
            }
          ]
        },
        {
          "name": "light",
          "localContext": {
            "variables": [
              {
                "name": "localDataVariable",
                "value": "0"
              }
            ]
          },
          "states": [
            {
              "name": "off",
              "initial": true,
              "on": [
                {
                  "event": "lightOff",
                  "actions": [
                    {
                      "reference": "doLightOff"
                    }
                  ]
                },
                {
                  "event": "lightOn",
                  "target": "on"
                }
              ]
            },
            {
              "name": "on",
              "on": [
                {
                  "event": "lightOn",
                  "actions": [
                    {
                      "reference": "doLightOn"
                    }
                  ]
                },
                {
                  "event": "lightOff",
                  "target": "off"
                }
              ]
            }
          ],
          "actions": [
            {
              "name": "doLightOn",
              "type": "invoke",
              "serviceType": "lightOn",
              "isLocal": true
            },
            {
              "name": "doLightOff",
              "type": "invoke",
              "serviceType": "lightOff",
              "isLocal": true
            }
          ]
        },
        {
          "name": "away",
          "initial": true,
          "entry": [
            {
              "reference": "writeData"
            }
          ],
          "on": [
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value"
                }
              ],
              "target": "approach"
            },
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value == false"
                }
              ],
              "actions": [
                {
                  "reference": "raiseLightOff"
                },
                {
                  "reference": "raiseGateUp"
                }
              ]
            }
          ]
        },
        {
          "name": "approach",
          "entry": [
            {
              "reference": "writeData"
            }
          ],
          "on": [
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value == false"
                }
              ],
              "target": "close"
            },
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value"
                }
              ],
              "actions": [
                {
                  "reference": "raiseLightOn"
                },
                {
                  "reference": "raiseGateDown"
                }
              ]
            }
          ]
        },
        {
          "name": "close",
          "entry": [
            {
              "reference": "writeData"
            }
          ],
          "on": [
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value"
                }
              ],
              "target": "present"
            },
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value == false"
                }
              ],
              "actions": [
                {
                  "reference": "raiseLightOn"
                },
                {
                  "reference": "raiseGateDown"
                }
              ]
            }
          ]
        },
        {
          "name": "present",
          "entry": [
            {
              "reference": "writeData"
            }
          ],
          "on": [
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value == false"
                }
              ],
              "target": "leaving"
            },
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value"
                }
              ],
              "actions": [
                {
                  "reference": "raiseLightOn"
                },
                {
                  "reference": "raiseGateDown"
                }
              ]
            }
          ]
        },
        {
          "name": "leaving",
          "entry": [
            {
              "reference": "writeData"
            }
          ],
          "on": [
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value"
                }
              ],
              "target": "left"
            },
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value == false"
                }
              ],
              "actions": [
                {
                  "reference": "raiseLightOff"
                },
                {
                  "reference": "raiseGateUp"
                }
              ]
            }
          ]
        },
        {
          "name": "left",
          "entry": [
            {
              "reference": "writeData"
            }
          ],
          "on": [
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value == false"
                }
              ],
              "target": "away"
            },
            {
              "event": "sensor",
              "guards": [
                {
                  "expression": "$value"
                }
              ],
              "actions": [
                {
                  "reference": "raiseLightOff"
                },
                {
                  "reference": "raiseGateUp"
                }
              ]
            }
          ]
        }
      ],
      "actions": [
        {
          "name": "raiseGateUp",
          "type": "raise",
          "event": {
            "name": "gateUp",
            "channel": "internal"
          }
        },
        {
          "name": "raiseGateDown",
          "type": "raise",
          "event": {
            "name": "gateDown",
            "channel": "internal"
          }
        },
        {
          "name": "raiseLightOn",
          "type": "raise",
          "event": {
            "name": "lightOn",
            "channel": "internal"
          }
        },
        {
          "name": "raiseLightOff",
          "type": "raise",
          "event": {
            "name": "lightOff",
            "channel": "internal"
          }
        },
        {
          "name": "writeData",
          "type": "assign",
          "variable": {
            "name": "localDataVariable",
            "value": "utility:genRandPayload([1024, 1024 * 10, 1024 * 100, 1024 * 1000])"
          }
        }
      ]
    }
  ]
}
